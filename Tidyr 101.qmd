---
title: "Tidyr-101"
author : "Daphn√© Perry"
format: 
  html: default
  pdf : default 
---

```{r}
here::i_am("git-101.Rproj")
library(here)
```

```{r}
#| message: false
library(ggplot2)
library(dplyr)
library(tidyr)
```

```{r}
data("EuStockMarkets")
```

## Displaying one time series
Lets first show the evolution of the DAX: 
 
```{r}
ggplot(EuStockMarkets, aes(y = DAX, x = time(EuStockMarkets)))+
  geom_line()
```
Here we apply the time function to the data frame, bcs we donc have a date/the time on the dataframe (bcs in fact its a data frame of time series, so the 4 time series are collected at the same date).
Ggplot is complaining a bit, bcs u need an additionnal package to leverage the time series w/ ggplot. 

So now, to do that cleanly: 
```{r}
EuStockMarkets <-
  EuStockMarkets |> 
    as_tibble() |> ## could be as.data.frame 
    mutate(date = as.numeric(time(EuStockMarkets)))
```

Now lets try again the graph rpztation
```{r}
ggplot(EuStockMarkets, aes(y = DAX, x = date))+
  geom_line()
```

Now, if we'd like to have also the CaC on the same graph, here to have it alone : 
```{r}
ggplot(EuStockMarkets, aes(y = CAC, x = date))+
  geom_line()
```

## Two indexes on the same grpah rpztation
So here we try to have DAX & CAC on the same graph rpztation

### Poor man's solution

```{r}
ggplot(EuStockMarkets, aes(y = CAC, x = date))+   # here we tell the dataframe we're working on & the mapping, that's the 1st graph rpztation
  geom_line(color="forestgreen")+  # we can add as many geom_line as we want
  geom_line(mapping = aes(y=DAX), color="darkred")   #don't modif the x, bcs we already mapped it in the 1st line
```
There is no way to automate that if we use this type of solution (ex : if 20 type of data, have to make 20 geom_line = relou)


### Tidyr solution
The prbl we are facing is in fact simple, in the sens that its caused by the fact that the date is in wide format (= situation where u have a large nb of columns, cad each of the object (here the date) is described by multiple variables). Its not adapted in ggplot, bcs it normally prefers long format (where a object is spreaded in multiple rows, instead of multiple columns). 
Ex of long format :

| Center | Center | Center |
|:------:|:------:|:------:|
| date   | name   | value  |
| 1991   | DAX    | ...    |
| 1991   | CAC    | ...    |
| 1991   | SMI    | ...    |
| 1991   | FTSE   | ...    |

2 main functions in tidyr : pivot longer / pivot wider (= pivot smthing in long format to wide format)
```{r}
EuStockMarkets |>
  pivot_longer(!date, names_to = "index") |>
  slice_head(n=10) |>
  knitr::kable()
```

```{r}
EuStockMarkets |>
  pivot_longer(!date, names_to = "index") |>
  ggplot(aes(x = date, y = value, color=index))+
  geom_line()
```
Great, we have a legend (automatically)





